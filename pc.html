<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Est√∫dio Criativo HD - Vers√£o Brush Pro</title>
    <style>
        :root {
            --primary: #8b5cf6;
            --accent: #38bdf8;
            --success: #22c55e;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #0f172a;
            --panel: #1e293b;
            --text: #f8fafc;
            --border: #334155;
        }

        * { box-sizing: border-box; user-select: none; }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--dark);
            color: var(--text);
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            background: var(--panel);
            border-bottom: 1px solid var(--border);
            z-index: 10;
        }

        .logo { font-weight: bold; font-size: 1.2rem; color: var(--accent); display: flex; align-items: center; gap: 10px; }
        .logo span { background: var(--primary); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; }

        .main-area {
            flex: 1;
            display: flex;
            position: relative;
            overflow: hidden;
        }

        /* SIDEBAR (Esquerda) */
        .sidebar {
            width: 260px;
            background: var(--panel);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 15px;
            gap: 15px;
            z-index: 5;
            overflow-y: auto;
        }

        .control-group {
            background: rgba(0,0,0,0.2);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .control-title {
            font-size: 0.85rem;
            text-transform: uppercase;
            color: #94a3b8;
            margin-bottom: 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
        }

        /* Inputs Deslizantes */
        input[type="range"] {
            width: 100%;
            height: 6px;
            background: #475569;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            margin: 10px 0;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px; height: 16px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
        }

        /* Bot√µes de Ferramentas */
        .tool-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        .tool-btn {
            background: #334155;
            border: none;
            color: white;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        .tool-btn:hover { background: #475569; }
        .tool-btn.active { background: var(--primary); }

        /* Lista de Pinc√©is */
        .brush-list {
            display: flex;
            flex-direction: column;
            gap: 5px;
            max-height: 200px;
            overflow-y: auto;
        }
        .brush-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background: #334155;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            border: 1px solid transparent;
        }
        .brush-item:hover { border-color: var(--accent); }
        .brush-item.active { background: var(--accent); color: var(--dark); font-weight: bold; }
        
        /* Formas Customizadas */
        #shapesContainer {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-top: 10px;
        }
        .custom-shape-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #334155;
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid transparent;
        }
        .custom-shape-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            flex: 1;
        }
        .btn-delete-shape {
            background: none; border: none; cursor: pointer; font-size: 1rem; opacity: 0.6;
        }
        .btn-delete-shape:hover { opacity: 1; transform: scale(1.1); }

        /* CANVAS */
        #canvas-wrapper {
            flex: 1;
            background: black;
            position: relative;
            cursor: crosshair;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        canvas { 
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        /* EDITOR DE FORMAS (Modal) */
        .shape-creator {
            position: absolute;
            top: 20px; left: 20px; right: 20px; bottom: 20px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            z-index: 100;
            display: none; /* Escondido por padr√£o */
            flex-direction: column;
            border-radius: 12px;
            border: 1px solid var(--border);
            padding: 20px;
        }
        .shape-creator.open { display: flex; }
        
        .creator-canvas-area {
            flex: 1;
            background: #1e293b;
            border: 2px dashed #475569;
            border-radius: 8px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        #creatorCanvas { background: transparent; cursor: crosshair; }

        .creator-controls {
            height: 60px;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
        }

        /* Bot√£o para abrir o criador */
        .btn-new-shape {
            width: 100%;
            padding: 10px;
            background: var(--success);
            color: black;
            font-weight: bold;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
        }
        .btn-new-shape:hover { filter: brightness(1.1); }

    </style>
</head>
<body>

    <div class="header">
        <div class="logo">üé® Est√∫dio HD <span>PRO</span></div>
        <div style="display: flex; gap: 10px;">
            <button class="tool-btn" id="btnRecord">‚è∫Ô∏è Gravar V√≠deo</button>
            <button class="tool-btn" id="btnDownload">üì∑ Foto</button>
        </div>
    </div>

    <div class="main-area">
        
        <div class="sidebar">
            
            <div class="control-group">
                <div class="control-title">Tamanho & Opacidade</div>
                <label>Tamanho: <span id="valSize">20</span></label>
                <input type="range" id="sizeRange" min="5" max="200" value="20">
                
                <label>Espalhamento: <span id="valSpread">10</span></label>
                <input type="range" id="spreadRange" min="0" max="100" value="10">
            </div>

            <div class="control-group">
                <div class="control-title">Paleta de Cores</div>
                <div class="tool-grid">
                    <button class="tool-btn active" onclick="setPalette('neon')">üåà Neon</button>
                    <button class="tool-btn" onclick="setPalette('fire')">üî• Fogo</button>
                    <button class="tool-btn" onclick="setPalette('ice')">‚ùÑÔ∏è Gelo</button>
                    <button class="tool-btn" onclick="setPalette('matrix')">üíª Matrix</button>
                    <button class="tool-btn" onclick="setPalette('cyber')">ü§ñ Cyber</button>
                    <button class="tool-btn" onclick="setPalette('mono')">‚ö´ Mono</button>
                </div>
            </div>

            <div class="control-group" style="flex: 1; display: flex; flex-direction: column;">
                <div class="control-title">Pinc√©is & Formas</div>
                <div class="brush-list" id="shapesContainer">
                    <div class="brush-item active" onclick="selectShape('circle')">‚è∫Ô∏è C√≠rculo Suave</div>
                    <div class="brush-item" onclick="selectShape('square')">‚èπÔ∏è Quadrado Digital</div>
                    <div class="brush-item" onclick="selectShape('star')">‚≠ê Estrela</div>
                </div>
                
                <button class="btn-new-shape" id="btnOpenCreator">‚ûï Criar Novo Pincel</button>
            </div>

        </div>

        <div id="canvas-wrapper">
            <canvas id="mainCanvas"></canvas>
        </div>

        <div class="shape-creator" id="creatorPanel">
            <div style="display: flex; justify-content: space-between; color: white; margin-bottom: 10px;">
                <h3>Criador de Pincel Personalizado</h3>
                <button onclick="toggleCreator(false)" style="background:none; border:none; color:white; font-size: 1.5rem; cursor:pointer;">&times;</button>
            </div>
            
            <div class="creator-canvas-area">
                <canvas id="creatorCanvas" width="400" height="400"></canvas>
                <div style="position: absolute; bottom: 10px; left: 10px; color: #94a3b8; font-size: 0.8rem;">
                    * Clique para adicionar pontos. O √∫ltimo ponto fecha a forma.
                </div>
            </div>

            <div class="creator-controls">
                <button class="tool-btn" onclick="clearCreator()">üßπ Limpar</button>
                <button class="tool-btn" onclick="undoCreator()">‚Ü©Ô∏è Desfazer</button>
                
                <div style="width: 1px; height: 30px; background: #334155; margin: 0 10px;"></div>

                <input type="text" id="shapeNameInput" placeholder="Nome da forma (ex: Estrela)" style="padding: 10px; background: #0f172a; border: 1px solid var(--border); color: white; border-radius: 4px;">

                <label style="display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: #cbd5e1; cursor: pointer; background: #334155; padding: 8px; border-radius: 4px;">
                    <input type="checkbox" id="fixedDirectionCheck" style="accent-color: #a855f7; width: 16px; height: 16px;">
                    üîí Dire√ß√£o √önica (N√£o rotacionar)
                </label>

                <div class="creator-tools" style="margin-top: 15px;">
                    <button class="tool-btn" onclick="toggleCreator(false)" style="background: transparent; border: 1px solid var(--border);">Cancelar</button>
                    <button class="tool-btn" id="btnSaveShape" style="background: var(--success); color:black; font-weight:bold;">Salvar Forma</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        /**
         * L√ìGICA CORE DO APLICATIVO
         */
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        
        let width, height;
        let particles = [];
        let mouse = { x: 0, y: 0, active: false };
        let currentPalette = 'neon';
        let currentShape = 'circle';
        
        // Configura√ß√µes
        const config = {
            size: 20,
            spread: 10,
            density: 2,
            decay: 0.96
        };

        // Paletas de Cor
        const palettes = {
            neon:   ['#f0f', '#0ff', '#ff0', '#0f0'],
            fire:   ['#ff0000', '#ff4d00', '#ff9900', '#ffcc00'],
            ice:    ['#a6f0ff', '#00ccff', '#0066ff', '#0000cc'],
            matrix: ['#0f0', '#00ff33', '#003300'],
            cyber:  ['#ff0055', '#220033', '#00dbe3'],
            mono:   ['#fff', '#aaa', '#555']
        };

        // Registro de Formas
        const customShapesRegistry = {};

        // Inicializa√ß√£o
        function init() {
            resize();
            window.addEventListener('resize', resize);
            
            // Mouse Events
            canvas.addEventListener('mousemove', e => {
                mouse.x = e.offsetX;
                mouse.y = e.offsetY;
                if(mouse.active) spawnParticles();
            });
            canvas.addEventListener('mousedown', () => { mouse.active = true; spawnParticles(); });
            canvas.addEventListener('mouseup', () => mouse.active = false);

            // UI Events
            document.getElementById('sizeRange').oninput = (e) => {
                config.size = parseInt(e.target.value);
                document.getElementById('valSize').innerText = config.size;
            };
            document.getElementById('spreadRange').oninput = (e) => {
                config.spread = parseInt(e.target.value);
                document.getElementById('valSpread').innerText = config.spread;
            };

            animate();
            initCreator();
        }

        function resize() {
            width = canvas.width = document.getElementById('canvas-wrapper').clientWidth;
            height = canvas.height = document.getElementById('canvas-wrapper').clientHeight;
        }

        function spawnParticles() {
            for(let i=0; i<config.density; i++) {
                particles.push(new Particle(mouse.x, mouse.y));
            }
        }

        class Particle {
            constructor(x, y) {
                this.x = x + (Math.random() - 0.5) * config.spread * 4;
                this.y = y + (Math.random() - 0.5) * config.spread * 4;
                this.size = Math.random() * config.size;
                this.life = 1.0;
                this.color = palettes[currentPalette][Math.floor(Math.random() * palettes[currentPalette].length)];
                
                // Movimento aleat√≥rio
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.rotation = Math.random() * Math.PI * 2;
                this.rotSpeed = (Math.random() - 0.5) * 0.2;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.rotation += this.rotSpeed;
                this.life *= config.decay;
                this.size *= 0.98;
            }

            draw() {
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                
                drawShape(this.x, this.y, this.size, currentShape, this.rotation);
                
                ctx.globalAlpha = 1;
            }
        }

        // Fun√ß√£o de Desenho Centralizada
        function drawShape(x, y, size, s, angle) {
            // Se for forma customizada
            if (customShapesRegistry[s]) {
                const points = customShapesRegistry[s];
                if (!points || points.length < 3) return; 
                
                // NOVO: Se a forma tiver a flag fixedRotation, for√ßamos o √¢ngulo para 0
                if (points.fixedRotation) {
                    angle = 0; 
                }

                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(angle); 
                
                ctx.beginPath();
                ctx.moveTo(points[0].x * size, points[0].y * size);
                for(let i=1; i<points.length; i++) {
                    ctx.lineTo(points[i].x * size, points[i].y * size);
                }
                ctx.closePath();
                ctx.fill();
                ctx.restore();
                return;
            }

            // Formas Padr√£o
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle);

            ctx.beginPath();
            if (s === 'circle') {
                ctx.arc(0, 0, size/2, 0, Math.PI*2);
            } else if (s === 'square') {
                ctx.rect(-size/2, -size/2, size, size);
            } else if (s === 'star') {
                for(let i=0; i<5; i++) {
                    ctx.lineTo(Math.cos((18+i*72)/180*Math.PI)*size/2, 
                               -Math.sin((18+i*72)/180*Math.PI)*size/2);
                    ctx.lineTo(Math.cos((54+i*72)/180*Math.PI)*size/4, 
                               -Math.sin((54+i*72)/180*Math.PI)*size/4);
                }
            }
            ctx.fill();
            ctx.restore();
        }

        function animate() {
            // Rastro suave
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, width, height);

            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.update();
                p.draw();
                if (p.life < 0.05) particles.splice(i, 1);
            }
            requestAnimationFrame(animate);
        }

        // Fun√ß√µes de Interface
        window.setPalette = (p) => {
            currentPalette = p;
            document.querySelectorAll('.control-group .tool-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        };

        window.selectShape = (s) => {
            currentShape = s;
            document.querySelectorAll('.brush-item').forEach(b => b.classList.remove('active'));
            
            // Remove active dos customizados tbm
            document.querySelectorAll('.custom-shape-label input').forEach(i => i.checked = false);

            if(event && event.currentTarget) event.currentTarget.classList.add('active');
        };

        // -------------------------------------------------------------------
        // SISTEMA DE CRIA√á√ÉO DE FORMAS (CREATOR)
        // -------------------------------------------------------------------
        
        let cCtx, creatorCanvas;
        let drawnPoints = [];
        let isCreating = false;

        function initCreator() {
            creatorCanvas = document.getElementById('creatorCanvas');
            cCtx = creatorCanvas.getContext('2d');
            
            creatorCanvas.addEventListener('mousedown', (e) => {
                const rect = creatorCanvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                drawnPoints.push({x, y});
                renderCreator();
            });
        }

        function renderCreator() {
            cCtx.clearRect(0,0,400,400);
            
            // Grid
            cCtx.strokeStyle = '#334155';
            cCtx.lineWidth = 1;
            cCtx.beginPath();
            cCtx.moveTo(200, 0); cCtx.lineTo(200, 400);
            cCtx.moveTo(0, 200); cCtx.lineTo(400, 200);
            cCtx.stroke();

            if (drawnPoints.length === 0) return;

            // Desenho
            cCtx.strokeStyle = '#22c55e';
            cCtx.lineWidth = 2;
            cCtx.fillStyle = 'rgba(34, 197, 94, 0.2)';
            
            cCtx.beginPath();
            cCtx.moveTo(drawnPoints[0].x, drawnPoints[0].y);
            for(let i=1; i<drawnPoints.length; i++) {
                cCtx.lineTo(drawnPoints[i].x, drawnPoints[i].y);
            }
            
            // Preview de fechamento
            if(drawnPoints.length > 2) {
                cCtx.closePath();
                cCtx.fill();
            }
            
            cCtx.stroke();

            // Pontos
            cCtx.fillStyle = 'white';
            drawnPoints.forEach(p => {
                cCtx.beginPath();
                cCtx.arc(p.x, p.y, 4, 0, Math.PI*2);
                cCtx.fill();
            });
        }

        window.toggleCreator = (show) => {
            const panel = document.getElementById('creatorPanel');
            if(show) {
                panel.classList.add('open');
                clearCreator();
            } else {
                panel.classList.remove('open');
            }
        };

        window.clearCreator = () => {
            drawnPoints = [];
            document.getElementById('shapeNameInput').value = '';
            document.getElementById('fixedDirectionCheck').checked = false; // Resetar checkbox
            renderCreator();
        };

        window.undoCreator = () => {
            drawnPoints.pop();
            renderCreator();
        };

        // Salvar Forma Customizada
        document.getElementById('btnSaveShape').onclick = () => {
            if(drawnPoints.length < 3) { alert("Desenhe ou importe uma forma!"); return; }

            const name = document.getElementById('shapeNameInput').value || 'Forma ' + (Object.keys(customShapesRegistry).length + 1);
            
            // NOVO: Ler o estado do checkbox
            const isFixed = document.getElementById('fixedDirectionCheck').checked;

            // Centralizar
            let minX = 400, maxX = 0, minY = 400, maxY = 0;
            drawnPoints.forEach(p => {
                if(p.x < minX) minX = p.x;
                if(p.x > maxX) maxX = p.x;
                if(p.y < minY) minY = p.y;
                if(p.y > maxY) maxY = p.y;
            });
            
            const centerX = (minX + maxX) / 2;
            const centerY = (minY + maxY) / 2;
            const scale = Math.max(maxX - minX, maxY - minY) || 1; // Normalizar tamanho

            const normalizedPoints = drawnPoints.map(p => ({
                x: (p.x - centerX) / scale,
                y: (p.y - centerY) / scale
            }));

            // NOVO: Salvar a propriedade de rota√ß√£o fixa dentro do array de pontos
            normalizedPoints.fixedRotation = isFixed;

            const id = 'custom_v_' + Date.now();
            customShapesRegistry[id] = normalizedPoints;

            const container = document.createElement('div');
            container.className = 'custom-shape-wrapper';
            
            // NOVO: Se for dire√ß√£o √∫nica, muda a borda para Roxo
            if (isFixed) {
                container.style.borderColor = '#a855f7'; // Roxo
                container.style.background = 'rgba(168, 85, 247, 0.1)';
            }
            
            const label = document.createElement('label');
            label.className = 'custom-shape-label';
            
            // NOVO: Se for dire√ß√£o √∫nica, muda o texto para Roxo
            if (isFixed) {
                label.style.color = '#d8b4fe'; // Roxo claro
            }

            label.innerHTML = `<input type="checkbox" value="${id}" checked> ${name} ${isFixed ? 'üîí' : ''}`;
            label.querySelector('input').onchange = updateShapesList;
            
            const delBtn = document.createElement('button');
            delBtn.className = 'btn-delete-shape';
            delBtn.innerHTML = 'üóëÔ∏è';
            delBtn.title = 'Excluir Forma';
            delBtn.onclick = (e) => {
                e.preventDefault(); e.stopPropagation();
                delete customShapesRegistry[id];
                container.remove();
                updateShapesList();
            };
            
            container.appendChild(label);
            container.appendChild(delBtn);
            document.getElementById('shapesContainer').appendChild(container);
            updateShapesList();
            toggleCreator(false);
        };

        function updateShapesList() {
            // L√≥gica para quando o usu√°rio seleciona uma forma customizada
            // Permite selecionar apenas 1 customizada por vez para simplificar
            document.querySelectorAll('.custom-shape-label input').forEach(input => {
                input.onclick = (e) => {
                    const id = e.target.value;
                    if(e.target.checked) {
                        currentShape = id;
                        // Desmarcar formas padr√£o
                        document.querySelectorAll('.brush-item').forEach(b => b.classList.remove('active'));
                        // Desmarcar outros customizados
                        document.querySelectorAll('.custom-shape-label input').forEach(other => {
                            if(other !== e.target) other.checked = false;
                        });
                    } else {
                        // Se desmarcar, volta pro circle
                        currentShape = 'circle';
                        document.querySelector('.brush-item').classList.add('active');
                    }
                };
            });
        }

        document.getElementById('btnOpenCreator').onclick = () => toggleCreator(true);

        init();
    </script>
</body>
</html>
